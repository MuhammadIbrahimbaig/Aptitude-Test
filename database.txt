Create database AptitudeTest;
use AptitudeTest;

CREATE TABLE Users (
    UserID INT identity(1,1) PRIMARY KEY,
    Username VARCHAR(50) UNIQUE NOT NULL,
    Password VARCHAR(255) NOT NULL,
    Email VARCHAR(100) UNIQUE NOT NULL,
    DateOfBirth DATE,
    RegistrationDate DATETIME DEFAULT GETDATE(),
);

CREATE TABLE Tests (
    TestID INT identity(1,1) PRIMARY KEY,
    TestName VARCHAR(100) NOT NULL,
    Description varchar(200),
    CreatedDate  DATETIME DEFAULT GETDATE()
	);

CREATE TABLE Questions (
    QuestionID INT identity(1,1) PRIMARY KEY,
    TestID INT,
    QuestionText varchar(300) NOT NULL,
    FOREIGN KEY (TestID) REFERENCES Tests(TestID) ON DELETE CASCADE
);

CREATE TABLE Options (
    OptionID INT identity(1,1) PRIMARY KEY,
    QuestionID INT,
    OptionText varchar(200) NOT NULL,
    IsCorrect varchar(200) NOT NULL,
    FOREIGN KEY (QuestionID) REFERENCES Questions(QuestionID) ON DELETE CASCADE
);

CREATE TABLE UserResponses (
    ResponseID INT identity(1,1) PRIMARY KEY,
    UserID INT,
    TestID INT,
    ResponseDate DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE,
    FOREIGN KEY (TestID) REFERENCES Tests(TestID) ON DELETE CASCADE
);

CREATE TABLE UserAnswers (
    AnswerID INT identity(1,1) PRIMARY KEY,
    ResponseID INT,
    QuestionID INT,
    OptionID INT,
    FOREIGN KEY (ResponseID) REFERENCES UserResponses(ResponseID) ON DELETE CASCADE,
    FOREIGN KEY (QuestionID) REFERENCES Questions(QuestionID) ON DELETE CASCADE,
    FOREIGN KEY (OptionID) REFERENCES Options(OptionID) ON DELETE SET NULL
);

CREATE TABLE Scores (
    ScoreID INT identity(1,1) PRIMARY KEY,
    UserID INT,
    TestID INT,
    Score DECIMAL(5, 2),
    FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE,
    FOREIGN KEY (TestID) REFERENCES Tests(TestID) ON DELETE CASCADE
);
